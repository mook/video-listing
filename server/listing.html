<!DOCTYPE html>
<html>
    <head>
        <title>{{ $.Name }}</title>
        <link href="data:text/plain," rel="icon">
        <style>
          :root {
            --color-foreground: #111;
            --color-dimmed: #666;
            --color-background: #eee;
          }

          @media (prefers-color-scheme: dark) {
            :root {
              --color-foreground: #eee;
              --color-dimmed: #666;
              --color-background: #111;
            }
          }

          :root {
            color: var(--color-foreground);
            background: var(--color-background);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 5vw;
            margin: 0;
          }
          body {
            margin: 0;
          }
          header {
            padding: 0.5em;
            font-weight: bold;
            border-bottom: 1px solid var(--color-foreground);
            position: sticky;
            top: 0;
            height: 159px;
            overflow: hidden;
            background: var(--color-background);
          }
          ul {
            list-style: none;
            margin: 0;
            padding: 0;
          }
          li {
            overflow: hidden;
            border: 1px solid color-mix(in hsl, var(--color-dimmed) 60%, transparent);
            border-width: 1px 0;
            padding: 0.5em;
          }
          .directories li object {
            float: left;
            width: 100px;
            height: 138px;
            margin-right: 0.5em;
          }
          .directories li object picture img {
            width: 100%;
          }
          .translation {
            font-size: 70%;
            color: var(--color-dimmed);
          }
          .translation:empty {
            display: none;
          }
          .files li {
            height: 159px;
            cursor: pointer;
          }

          :any-link {
            color: inherit;
            text-decoration: none;
          }
          li[data-seen] {
            color: var(--color-dimmed);
          }
        </style>
        <script>
          function seen(event) {
            const { target } = event;
            const path = target.getAttribute("data-path");
            const seen = target.hasAttribute("data-seen");
            fetch(`/m/${ path }?${ !seen }`, {
              method: 'POST',
            }).then(() => {
              if (seen) {
                target.removeAttribute("data-seen");
              } else {
                target.setAttribute("data-seen", true);
              }
            }).catch(ex => console.error(ex));
          }
        </script>
    </head>
    <body>
        <a
          {{ if .Path }} href=".." {{ end }}
        >
          <header>
              <div class="title">{{ $.Name }}</div>
              <div class="translation native">{{ $.Native }}</div>
              <div class="translation english">{{ $.English }}</div>
          </header>
        </a>
        <ul class="directories">
            {{ range $.Directories }}
            <a href="/l/{{ .EscapedFullPath }}/">
              <li {{ if .Seen }} data-seen="true" {{ end }} >
                {{ if .HasMedia }}
                  <object data="/i/{{ .EscapedFullPath }}" type="image/jpeg">
                    <picture>
                      <source media="(prefers-color-scheme: light)"
                        srcset="/i/fallback.svg?666" />
                      <source media="(prefers-color-scheme: dark)"
                        srcset="/i/fallback.svg?222" />
                      <img src="/i/fallback.svg">
                    </picture>
                  </object>
                {{ else }}
                  <object><!-- exists only for layout --></object>
                {{ end }}
                <div class="title">{{ .Name }}</div>
                <div class="translation native">{{ .Native }}</div>
                <div class="translation english">{{ .English }}</div>
              </li>
            </a>
            {{ end }}
        </ul>
        <ul class="files">
            {{ range $.Files }}
            <li
              {{ if .Seen }} data-seen="true" {{ end }}
              data-path="{{ .EscapedFullPath }}"
              onclick="seen(event)"
              >
              {{ .Title }}
            </li>
            {{ end }}
        </ul>
    </body>
</html>
